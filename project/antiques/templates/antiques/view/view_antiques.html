{% extends 'dashboard/base.html' %}
{% load static %}

{% block content %}

<head>
    <link rel="stylesheet" href="{% static 'css/antiques/view_antiques.css' %}">
</head>

<div class="antiques-container">
    <div class="header-section">
        <h2 class="page-title">Browse Antiques</h2>
        <p class="subtitle">Discover timeless treasures from our curated collection</p>
    </div>

    <!-- Search and Filter Section -->
    <div class="search-filter-section">
        <div class="search-wrapper">
            <i class="fa-solid fa-search search-icon"></i>
            <input 
                type="text" 
                id="searchInput" 
                class="search-input" 
                placeholder="Search antiques by title or description..."
            >
        </div>
        
        <div class="filter-wrapper">

            <select id="typeFilter" class="filter-select">
                <option value="">All Types</option>
                {% for type in antique_types %}
                    <option value="{{ type }}">{{ type }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <!-- Results Count -->
    <div class="results-info">
        <span id="resultsCount">{{ antiques|length }}</span> antiques found
    </div>

    <!-- Antiques Grid -->
    <div class="antiques-grid" id="antiquesGrid">
        {% for a in antiques %}
        <div class="antique-card" 
             data-title="{{ a.title|lower }}" 
             data-description="{{ a.description|lower }}"
             data-type="{{ a.type_of_antique }}"
             onclick="window.location.href='{% url 'antiques:antique_detail' a.short_id a.slug %}'">
            
            <div class="card-img-wrapper">
                {% if a.images.exists %}
                    <div class="image-carousel" data-antique-id="{{ a.id }}">
                        {% for img in a.images.all %}
                            <img src="{{ img.image.url }}" 
                                 alt="{{ a.title }}" 
                                 class="carousel-image {% if forloop.first %}active{% endif %}"
                                 loading="lazy">
                        {% endfor %}
                        
                        {% if a.images.count > 1 %}
                            <div class="carousel-controls">
                                <button class="carousel-btn prev-btn" onclick="event.stopPropagation(); changeImage(this, -1)">
                                    <i class="fa-solid fa-chevron-left"></i>
                                </button>
                                <button class="carousel-btn next-btn" onclick="event.stopPropagation(); changeImage(this, 1)">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </button>
                            </div>
                            <div class="image-dots">
                                {% for img in a.images.all %}
                                    <span class="dot {% if forloop.first %}active{% endif %}"></span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                {% else %}
                    <img src="{% static 'images/placeholder.png' %}" alt="No Image Available">
                {% endif %}
            </div>

            <div class="card-body">
                <h5 class="card-title">{{ a.title }}</h5>
                <p class="card-type">
                    <i class="fa-solid fa-tag"></i> {{ a.type_of_antique }}
                </p>
                <p class="card-description">{{ a.description|truncatewords:15 }}</p>
                <div class="card-footer">
                    <p class="price-tag">${{ a.price }}</p>
                    {% if a.quantity > 0 %}
                        <span class="stock-badge in-stock">In Stock</span>
                    {% else %}
                        <span class="stock-badge out-of-stock">Sold Out</span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% empty %}
        <div class="no-results">
            <i class="fa-solid fa-search"></i>
            <p>No antiques found</p>
        </div>
        {% endfor %}
    </div>

    <!-- Load More Button -->
    <div class="load-more-wrapper" id="loadMoreWrapper" style="display: none;">
        <button class="load-more-btn" id="loadMoreBtn">
            <i class="fa-solid fa-chevron-down"></i> Load More Antiques
        </button>
    </div>
</div>

<!-- Wishlist Modal -->
<div class="modal fade" id="wishlistModal" tabindex="-1" aria-labelledby="wishlistModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="wishlistModalLabel">
            <i class="fa-regular fa-heart"></i> Add to Wishlist
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="wishlistForm">
            {% csrf_token %}
            <input type="hidden" name="antique_id" id="modal-antique-id">
            <div class="mb-3">
                <label for="wishlistSelect" class="form-label">
                    Select Wishlist
                </label>
                <select id="wishlistSelect" name="wishlist_id" class="form-select">
                    {% for w in wishlists %}
                        <option value="{{ w.id }}">{{ w.title }}</option>
                    {% empty %}
                        <option value="">No wishlist available</option>
                    {% endfor %}
                </select>
                <a href="{% url 'antiques:create_wishlist' %}" class="btn btn-secondary mt-2">
                    <i class="fa-solid fa-plus"></i> Create New Wishlist
                </a>
            </div>
            <button type="submit" class="btn-primary">
                Add to Wishlist
            </button>
        </form>
        <div id="wishlist-msg" class="mt-2"></div>
      </div>
    </div>
  </div>
</div>

<script src="{% static 'js/antiques/view_antiques.js' %}"></script>

{% endblock %}